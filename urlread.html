<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>URL Interpolation and Conversation Details</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <!-- Genesys Cloud Client App SDK -->
    <script src="https://sdk-cdn.mypurecloud.com/client-apps/2.6.7/purecloud-client-app-sdk.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        h1, h2, h3 {
            color: #333;
        }
        .ex-url, .welcome-text, #conversationIdDisplay, #debugInfo {
            background-color: #f4f4f4;
            padding: 10px;
            margin-bottom: 20px;
            border-radius: 5px;
        }
        button {
            background-color: #4CAF50;
            border: none;
            color: white;
            padding: 15px 32px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            margin: 4px 2px;
            cursor: pointer;
        }
        #debugInfo {
            border: 1px solid #ccc;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>URL Interpolation and Conversation Details</h1>
        
        <h2>URL Interpolation</h2>
        <p>Data can be seeded into an app (Standalone or Widget) via URL string replacement.</p>
        
        <h3>URL</h3>
        <div class="ex-url"></div>
        
        <h3>Localization Demo</h3>
        <div class="welcome-text"></div>
        
        <h2>Conversation Details</h2>
        <div id="conversationIdDisplay"></div>
        <button id="showDetailsBtn">Show Conversation Details</button>
        
        <h3>Debug Information</h3>
        <div id="debugInfo"></div>
    </div>

    <script>
        let myClientApp;
        let conversationId;

        function getParameterByName(name, url) {
            if (!url) url = window.location.href;
            name = name.replace(/[\[\]]/g, "\\$&");
            var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)", "i"),
                results = regex.exec(url);
            if (!results) return null;
            if (!results[2]) return '';
            return decodeURIComponent(results[2].replace(/\+/g, " "));
        }

        function updateDebugInfo() {
            var debugInfo = "Debug Information:\n";
            debugInfo += "myClientApp initialized: " + (typeof myClientApp !== 'undefined') + "\n";
            if (typeof myClientApp !== 'undefined') {
                debugInfo += "myClientApp.conversations defined: " + (typeof myClientApp.conversations !== 'undefined') + "\n";
                if (typeof myClientApp.conversations !== 'undefined') {
                    debugInfo += "myClientApp.conversations.showInteractionDetails defined: " + (typeof myClientApp.conversations.showInteractionDetails === 'function') + "\n";
                }
            }
            debugInfo += "conversationId: " + conversationId + "\n";
            debugInfo += "gcHostOrigin: " + getParameterByName('gcHostOrigin') + "\n";
            debugInfo += "gcTargetEnv: " + getParameterByName('gcTargetEnv') + "\n";
            $('#debugInfo').text(debugInfo);
            console.log(debugInfo);
        }

        function initializeSDK() {
            return new Promise((resolve, reject) => {
                try {
                    const ClientApp = window.purecloud.apps.ClientApp;
                    myClientApp = new ClientApp({
                        pcEnvironmentQueryParam: 'pcEnvironment'
                    });
                    
                    myClientApp.lifecycle.addbootstrapListener(() => {
                        console.log('SDK bootstrap complete');
                        resolve();
                    });

                    myClientApp.alerting.showToastPopup('SDK Initialized', 'Genesys Cloud');
                } catch (error) {
                    console.error('Error initializing SDK:', error);
                    $('#debugInfo').text('Error initializing SDK: ' + error.message);
                    reject(error);
                }
            });
        }

        $(document).ready(function () {
            var url = window.location.href;
            $('.ex-url').text(url);

            var welcomeText = getParameterByName('welcome_text') || 'Welcome!';
            $('.welcome-text').text(welcomeText);

            conversationId = getParameterByName('conversationId') || getParameterByName('interactionId');
            if (conversationId) {
                $('#conversationIdDisplay').text('Conversation ID: ' + conversationId);
            } else {
                $('#conversationIdDisplay').text('Conversation ID not found in the URL.');
            }

            initializeSDK().then(() => {
                console.log('SDK initialized successfully');
                updateDebugInfo();
            }).catch((error) => {
                console.error('Failed to initialize SDK:', error);
            });

            $('#showDetailsBtn').click(function() {
                console.log('Button clicked');
                updateDebugInfo();
                if (conversationId) {
                    if (typeof myClientApp !== 'undefined' && myClientApp.conversations && typeof myClientApp.conversations.showInteractionDetails === 'function') {
                        try {
                            console.log('Attempting to show interaction details for conversation:', conversationId);
                            myClientApp.conversations.showInteractionDetails(conversationId);
                        } catch (error) {
                            console.error('Error calling showInteractionDetails:', error);
                            alert('Error calling showInteractionDetails: ' + error.message);
                        }
                    } else {
                        console.error('Client SDK not initialized or showInteractionDetails method not available');
                        alert('Client SDK not initialized or showInteractionDetails method not available. Check the Debug Information for details.');
                    }
                } else {
                    console.error('Conversation ID not found in the URL');
                    alert('Conversation ID not found in the URL.');
                }
            });
        });
    </script>
</body>
</html>
