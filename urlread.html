<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>URL Interpolation with Interaction Details</title>
    <style>
        #statusMessage {
            margin-top: 10px;
            padding: 10px;
            border-radius: 5px;
        }
        .error { background-color: #ffeeee; color: #cc0000; }
        .info { background-color: #eeeeff; color: #0000cc; }
        .success { background-color: #eeffee; color: #00cc00; }
    </style>
    <script>
        // Function to get conversationID from URL parameters
        function getConversationIdFromUrl() {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get('conversationId');
        }

        // Function to show interaction details with retry mechanism
        function showInteractionDetails(conversationId, retryCount = 0) {
            if (typeof myClientApp !== 'undefined' && 
                myClientApp.conversations && 
                typeof myClientApp.conversations.showInteractionDetails === 'function') {
                try {
                    myClientApp.conversations.showInteractionDetails(conversationId);
                    updateStatus('Interaction details loaded successfully.', 'success');
                } catch (error) {
                    updateStatus(`Error showing interaction details: ${error.message}`, 'error');
                }
            } else {
                if (retryCount < 5) {
                    updateStatus(`Waiting for myClientApp to be available... (Attempt ${retryCount + 1}/5)`, 'info');
                    setTimeout(() => showInteractionDetails(conversationId, retryCount + 1), 1000);
                } else {
                    updateStatus('Unable to show interaction details. The required function is not available. Please check if myClientApp is properly loaded.', 'error');
                }
            }
        }

        // Function to update status message
        function updateStatus(message, type) {
            const statusElement = document.getElementById('statusMessage');
            statusElement.textContent = message;
            statusElement.className = type;
        }

        // Execute when the DOM is fully loaded
        document.addEventListener('DOMContentLoaded', function() {
            // Display the current URL
            document.querySelector('.ex-url').textContent = window.location.href;

            const conversationId = getConversationIdFromUrl();
            if (conversationId) {
                document.getElementById('conversationIdDisplay').textContent = conversationId;
                showInteractionDetails(conversationId);
            } else {
                updateStatus('No conversationId found in URL. Please add a conversationId parameter to the URL.', 'error');
            }
        });
    </script>
</head>
<body>
    <h1>URL Interpolation</h1>
    <p>For full functionality of this site it is necessary to enable JavaScript. Here are the <a href="http://www.enable-javascript.com/" target="_blank">instructions how to enable JavaScript in your web browser</a>.</p>

    <h2>URL</h2>
    <div class="ex-url"></div>

    <h2>Localization Demo</h2>
    <div class="welcome-text"></div>

    <div id="interactionDetails">
        <h2>Interaction Details</h2>
        <p>Conversation ID: <span id="conversationIdDisplay"></span></p>
        <div id="statusMessage"></div>
    </div>
</body>
</html>
